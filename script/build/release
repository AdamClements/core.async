#!/usr/bin/env bash

# Create a new core.async release

set -ex

cd `dirname $0`/../..

version_template=`cat VERSION_TEMPLATE`

git_revision=`script/build/git_revision`

prefix=${version_template%%GENERATED_VERSION*}
tag=v$prefix${git_revision:0:${#git_revision}-7}

script/build/pom

if [ "$HUDSON" = "true" ]; then
    mvn -X -e --fail-at-end -Psonatype-oss-release \
        clean deploy

else
    echo "Skipping remote deployment and Git tag because we are not on Hudson."
    mvn clean install
fi

